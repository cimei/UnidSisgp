{% extends "base.html" %}
{% block content %}
<div class="jumbotron">

    <div class="row justify-content-center"><h5>Atividade: <b>{{ativs[0].titulo}}</b> ({{qtd_ativs}} ocorrências)</h5></div>
    <br>

    <div class="container d-flex justify-content-center">
      <div class="row justify-content-center">
        <div class="col align-self-center" style="width: 150px;">Legenda:</div>
        <div class="col align-self-center" style="width: 100px;"><span class="badge badge-secondary"><small>Programada</small></span></div>
        <div class="col align-self-center" style="width: 100px;"><span class="badge badge-primary"><small>Em execução</small></span></div>
        <div class="col align-self-center" style="width: 100px;"><span class="badge badge-success"><small>Concluída</small></span></div>
      </div>
    </div>
<br>
    <div class="container">
      {% set cont = namespace(i = 0) %}
      {% set conclu = namespace(i = 0) %}

      {% for l in range(1,qtd_linhas+1)%}

        <div class="row justify-content-md-center">

          {% for c in range(1,qtd_colunas+1)%}
            {% set cont.i =  cont.i + 1 %}

            <div class="card text-center" style="width: 8rem;">

              {% if cont.i > qtd_ativs %}
                <!-- não faça nada -->
              
              {% elif ativs[cont.i-1].situa == 'Programada' %}
                <div class="card-body text-white bg-secondary">
                  <span class="card-title">
                    <a href="" data-toggle='modal' data-target='#ativ_modal{{cont.i}}' style="color:rgb(255, 255, 255);"><abbr title="Clique aqui para ver detalhes">{{cont.i}}/{{qtd_ativs}}</abbr></a>
                  </span><br>

                  <small>{{ativs[cont.i-1].quantidade}} - {{ativs[cont.i-1].tempoPrevistoPorItem|string()|replace(".",",")}} h
                    {% if ativs[cont.i-1].quantidade > 1 %}
                     - {{ativs[cont.i-1].tempoPrevistoTotal|string()|replace(".",",")}} h
                    {% endif %} </small>
 
                    {% if usuario.pesNome == demanda.pesNome %}
                      <div class="card-footer text-white bg-secondary">
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                          <div class="col"><a href="{{url_for('demandas.inicia_finaliza_atividade',pacto_id=pacto_id,ativ_pacto_id=ativs[cont.i-1].id,acao='i')}}" class="btn btn-primary btn-sm" role="button" aria-pressed="true">i</a></div>
                          <div class="col"><a href="{{url_for('demandas.inicia_finaliza_atividade',pacto_id=pacto_id,ativ_pacto_id=ativs[cont.i-1].id,acao='f')}}" class="btn btn-success btn-sm" role="button" aria-pressed="true">f</a></div>
                        </div>
                      </div>
                    {% endif %}  
                </div>

              {% elif ativs[cont.i-1].situa == 'Em execução' %}

                <div class="card-body text-white bg-primary">
                  <span class="card-title">
                    <a href="" data-toggle='modal' data-target='#ativ_modal{{cont.i}}' style="color:rgb(255, 255, 255);"><abbr title="Clique aqui para ver detalhes">{{cont.i}}/{{qtd_ativs}}</abbr></a>
                  <span><br>
                    <small>{{ativs[cont.i-1].quantidade}} - {{ativs[cont.i-1].tempoPrevistoPorItem|string()|replace(".",",")}} h
                      {% if ativs[cont.i-1].quantidade > 1 %}
                       - {{ativs[cont.i-1].tempoPrevistoTotal|string()|replace(".",",")}} h
                      {% endif %} </small><br>
                  <small>(i) {{ativs[cont.i-1].dataInicio.strftime('%d/%m/%Y')}}</small>

                  {% if usuario.pesNome == demanda.pesNome %}
                    <div class="card-footer text-white bg-primary">
                      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                          <div class="col"><small><a href="{{url_for('demandas.inicia_finaliza_atividade',pacto_id=pacto_id,ativ_pacto_id=ativs[cont.i-1].id,acao='f')}}" class="btn btn-success btn-sm" role="button" aria-pressed="true">f</a></small></div>
                          <div class="col"><small><a href="{{url_for('demandas.add_assunto',pacto_id=pacto_id,ativ_pacto_id=ativs[cont.i-1].id)}}" class="btn btn-warning btn-sm" role="button" aria-pressed="true">a</a></small></div>
                      </div>
                    </div>  
                    {% endif %}
                </div> 
                
              {% elif ativs[cont.i-1].situa == 'Concluída' %}

                {% set conclu.i =  conclu.i + 1 %}

                <div class="card-body text-white bg-success">
                  <span class="card-title">
                    <a href="" data-toggle='modal' data-target='#ativ_modal{{cont.i}}' style="color:rgb(255, 255, 255);"><abbr title="Clique aqui para ver detalhes">{{cont.i}}/{{qtd_ativs}}</abbr></a>
                  </span><br>
                  <small>{{ativs[cont.i-1].quantidade}} - {{ativs[cont.i-1].tempoPrevistoPorItem|string()|replace(".",",")}} h
                    {% if ativs[cont.i-1].quantidade > 1 %}
                     - {{ativs[cont.i-1].tempoPrevistoTotal|string()|replace(".",",")}} h
                    {% endif %} </small><br>
                  <small>(i) {{ativs[cont.i-1].dataInicio.strftime('%d/%m/%Y')}}</small><br>
                  <small>(f) {{ativs[cont.i-1].dataFim.strftime('%d/%m/%Y')}}</small>
                </div>  

              {% else %}
              
                <div class="card-body text-white bg-warning">
                    <div class="col">{{cont.i}} <small>{{ativs[cont.i-1].tempoPrevistoTotal}}</small></div>
                </div>
              
              {% endif %}

            </div> 


            {% if cont.i <= qtd_ativs %}
            {# modal para verificar tipo de solicitação #}

            <div class="modal" tabindex="-1" role="dialog" id="ativ_modal{{cont.i}}">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-body">

                    <ul class="small list-group">
                      {% if ativs[cont.i-1].chave != None and ativs[cont.i-1].chave != '' %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                          <div class="ms-2 me-auto">
                            <div>Objeto:<b> {{ativs[cont.i-1].chave}}</b></div>
                          </div>
                        </li> 
                      {% endif %}

                      <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                          <div><span class="text-muted"> Descrição: </span><br> {% if ativs[cont.i-1].tit == None%}Não informada{% else %}{{ativs[cont.i-1].tit}}{% endif %} </div>
                        </div>
                      </li> 
                      
                      {% if ativs[cont.i-1].situa == 'Em execução' %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                          <div class="ms-2 me-auto">
                            <div><span class="text-muted"> Considerações: </span><br> {% if ativs[cont.i-1].desc == None%}Não informada{% else %}{{ativs[cont.i-1].desc}}{% endif %} </div>
                          </div>
                        </li>
                      {% elif ativs[cont.i-1].situa == 'Concluída' %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                          <div class="ms-2 me-auto">
                            <div><span class="text-muted"> Conclusão: </span><br> {% if ativs[cont.i-1].desc == None%}Não informada{% else %}{{ativs[cont.i-1].desc}}{% endif %} </div>
                          </div>
                        </li>
                      {% endif %}

                      <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                          <div><span class="text-muted"> Modalidade: {% if ativs[cont.i-1].descricao == None%}N.I.{% else %}{{ativs[cont.i-1].descricao}}{% endif %} - </span>
                              <span class="text-muted"> Quantidade: {% if ativs[cont.i-1].quantidade == None%}0{% else %}{{ativs[cont.i-1].quantidade}}{% endif %}</span> <br>
                              <span class="text-muted"> Tempo previsto por item: {% if ativs[cont.i-1].tempoPrevistoPorItem == None%}0{% else %}{{ativs[cont.i-1].tempoPrevistoPorItem|string()|replace(".",",")}}{% endif %} - </span>
                              <span class="text-muted"> Tempo previsto total: {% if ativs[cont.i-1].tempoPrevistoTotal == None%}0{% else %}{{ativs[cont.i-1].tempoPrevistoTotal|string()|replace(".",",")}}{% endif %}</span><br></div>
                        </div>
                      </li>

                      {% if ativs[cont.i-1].situa == 'Concluída' %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                          <div class="ms-2 me-auto">
                            <div><span class="text-muted"> Tempo realizado: {% if ativs[cont.i-1].tempoRealizado == None%}0{% else %}{{ativs[cont.i-1].tempoRealizado|string()|replace(".",",")}}{% endif %} - </span>
                                <span class="text-muted"> Tempo homologado: {% if ativs[cont.i-1].tempoHomologado == None%}0{% else %}{{ativs[cont.i-1].tempoHomologado|string()|replace(".",",")}}{% endif %} -</span>
                                <span class="text-muted"> Nota: {% if ativs[cont.i-1].nota == None%}0{% else %}{{ativs[cont.i-1].nota|string()|replace(".",",")}}{% endif %} </span>
                          </div>
                        </li>
                        {% if ativs[cont.i-1].justificativa != None and ativs[cont.i-1].justificativa !='' %}
                          <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                              <div><span class="text-muted"> Justificativa: </span><br> {{ativs[cont.i-1].justificativa}} </div>
                            </div>
                          </li>
                        {% endif %}
                      {% endif %}

                    </ul>
            
                  </div>
                </div>
              </div>
            </div>

            {% endif %}


          
            {% endfor %}
        </div>
      {% endfor %}

      <br>
      <div class="progress" style="height: 18px; background-color: rgb(255, 255, 255);">
        <div class="progress-bar bg-success" role="progressbar" aria-label="Progresso da atividade" style="width: {{(100 * conclu.i / qtd_ativs)|round|int}}%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            {{(100 * conclu.i / qtd_ativs)|round|int}}%
        </div>    
      </div>

    </div>


</div>
{% endblock %}
